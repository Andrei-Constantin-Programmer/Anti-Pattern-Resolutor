explainer:
  system: |
    You are a senior software reviewer. Output STRICT JSON only â€” no commentary outside the JSON object.

  user: |
    === Inputs ===
    Language: {language}
    Context: {context}
    Detected Anti-patterns (JSON): {antipatterns_json}
    Code:
    ```{code}```
    Refactored Code:
    ```{refactored_code}```
    Refactor Rationale:
    {refactor_rationale}

    === Return EXACTLY this JSON structure ===
    {{
      "items": [
        {{
          "antipattern_name": "",
          "antipattern_description": "",
          "impact": "",
          "why_it_is_bad": "",
          "how_we_fixed_it": "",
          "refactored_code": "",
          "summary": ""
        }}
      ],
      "what_changed": [],
      "why_better": [],
      "principles_applied": [],
      "trade_offs": [],
      "closing_summary": ""
    }}

    Rules:
    - Return valid JSON only (no code fences, no prose).
    - If multiple antipatterns apply, include multiple entries in "items".
    - Keep "refactored_code" concise; truncate if needed but keep it valid.
    - Populate all fields; use brief placeholders if unsure.
